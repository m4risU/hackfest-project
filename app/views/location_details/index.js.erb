<% @location.departing_locations.each do |location| %>
var loc<%= location.id %> = new google.maps.LatLng(<%= location.lat %>, <%= location.lng %>);
var marker<%= location.id %> = new google.maps.Marker({
  position:loc<%= location.id %>,
  title:'<%= location.name %>',
  map:map,
  icon:'<%= asset_path("bus-tour.png") %>',
  location_id: <%= location.id %>
});

homeLocationMarkers.push(marker<%= location.id %>);

google.maps.event.addListener(marker<%= location.id %>, "mouseover", function () {
  $("#<%= dom_id(location, :nearby) %>").parent().stop(true, true).effect("highlight", {}, 5000);
});

google.maps.event.addListener(marker<%= location.id %>, "click", function () {
//  hide others
  $(".location-panel").hide();
  var location_id = this.location_id;
//  remove map markers
  removeHomeMarkers();

//  fetch more details
  $.get('/location_details/' + location_id, function (data) {
    $("#<%= dom_id(@location, :nearby) %>").parent().parent().append(data);
    $.getScript('/location_details/' + location_id + '.js');
  });

//  show more details
  $("#<%= dom_id(@location, :nearby) %>").stop(true, true).fadeIn();
});

<% end %>

// drawing shapes

<% @location.departing_routes.each_with_index do |departing_route, index| %>
var poly<%= index %>;

var polyOptions<%= index %> = {
  strokeColor:'#000000',
  strokeOpacity:1.0,
  strokeWeight:3
};

poly<%= index %> = new google.maps.Polyline(polyOptions<%= index %>);
poly<%= index %>.setMap(map);

var path<%= index %> = poly<%= index %>.getPath();
<% departing_route.each do |loc_id| %>
path<%= index %>.push(marker<%= loc_id %>.getPosition());
<% end %>

homePolys.push(poly<%= index %>);
<% end %>